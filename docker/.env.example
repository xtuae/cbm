# ===============================================================================================
# DOCKER ENVIRONMENT CONFIGURATION - CREDITS MARKETPLACE PLATFORM
# ===============================================================================================
# This file contains Docker and container-specific environment variables
# Copy this file to docker/.env and fill in your actual values
# Used by docker-compose.yml and container build processes

# ===============================================================================================
# DOCKER COMPOSE PROFILES
# ===============================================================================================

# Which docker-compose profile to use (dev, staging, prod)
COMPOSE_PROFILE=dev

# Docker image tags
WEB_IMAGE_TAG=latest
BACKEND_IMAGE_TAG=latest
DATABASE_IMAGE_TAG=15

# ===============================================================================================
# CONTAINER RESOURCE LIMITS
# ===============================================================================================

# Web/Frontend container limits
WEB_MEMORY_LIMIT=512m
WEB_MEMORY_RESERVATION=256m
WEB_CPU_SHARES=512
WEB_CPU_QUOTA=50000

# Backend/API container limits
BACKEND_MEMORY_LIMIT=1g
BACKEND_MEMORY_RESERVATION=512m
BACKEND_CPU_SHARES=1024
BACKEND_CPU_QUOTA=100000

# Database container limits
DB_MEMORY_LIMIT=2g
DB_MEMORY_RESERVATION=1g
DB_CPU_SHARES=2048
DB_CPU_QUOTA=200000

# ===============================================================================================
# CONTAINER HEALTH CHECKS
# ===============================================================================================

# Health check intervals (in seconds)
WEB_HEALTH_INTERVAL=30
WEB_HEALTH_TIMEOUT=10
WEB_HEALTH_RETRIES=3

BACKEND_HEALTH_INTERVAL=30
BACKEND_HEALTH_TIMEOUT=10
BACKEND_HEALTH_RETRIES=3

DB_HEALTH_INTERVAL=10
DB_HEALTH_TIMEOUT=5
DB_HEALTH_RETRIES=5

# ===============================================================================================
# CONTAINER NETWORKING
# ===============================================================================================

# Internal Docker network
DOCKER_NETWORK=cbm-platform-network
DOCKER_NETWORK_SUBNET=172.20.0.0/16

# Port mappings (host:container)
WEB_HTTP_PORT=3000
WEB_HTTPS_PORT=3443
BACKEND_PORT=8000
SUPABASE_PORT=54321
SUPABASE_STUDIO_PORT=54323
DATABASE_PORT=54322

# ===============================================================================================
# CONTAINER MOUNT POINTS
# ===============================================================================================

# Volume mounts for persistent data
DB_DATA_MOUNT=cbm_platform_db_data:/var/lib/postgresql/data
BACKUP_MOUNT=cbm_platform_backups:/backups
LOGS_MOUNT=cbm_platform_logs:/app/logs

# ===============================================================================================
# CONTAINER BUILD CONTEXT
# ===============================================================================================

# Docker build arguments passed from environment
BUILD_ARG_NODE_ENV=production
BUILD_ARG_NPM_REGISTRY=https://registry.npmjs.org/

# ===============================================================================================
# DEVELOPMENT CONTAINERS
# ===============================================================================================

# Hot reload configuration
WEB_WATCH_POLL_INTERVAL=1000
BACKEND_WATCH_POLL_INTERVAL=1000

# Development debugging
ENABLE_WEB_DEBUGGER=false
ENABLE_BACKEND_DEBUGGER=false

# ===============================================================================================
# CONTAINER LOGGING
# ===============================================================================================

# Container log configuration
LOG_MAX_SIZE=10m
LOG_MAX_FILE=3

# Log drivers
WEB_LOG_DRIVER=json-file
BACKEND_LOG_DRIVER=json-file
DB_LOG_DRIVER=json-file

# ===============================================================================================
# CONTAINER SECRETS MANAGEMENT
# ===============================================================================================

# External secrets files (if using Docker secrets)
SECRETS_BACKEND=/run/secrets/backend_env
SECRETS_DB=/run/secrets/db_env

# ===============================================================================================
# MONITORING & OBSERVABILITY
# ===============================================================================================

# Container monitoring
ENABLE_PROMETHEUS_METRICS=true
METRICS_PORT=9090

# Log aggregation labels
SERVICE_NAME=cbm-platform
SERVICE_VERSION=1.0.0
ENVIRONMENT=docker

# ===============================================================================================
# SECURITY & COMPLIANCE
# ===============================================================================================

# Container security
RUN_AS_NON_ROOT=true
READ_ONLY_FILESYSTEM=true
DROP_ALL_CAPABILITIES=true

# Security scanning
ENABLE_TRIVY_SCAN=true
ENABLE_CLAIR_SCAN=false

# ===============================================================================================
# PRODUCTION CHECKLIST - DOCKER DEPLOYMENT
# ===============================================================================================
#
# CONTAINER SECURITY
# ✅ Use non-root users in containers
# ✅ Implement read-only filesystems where possible
# ✅ Drop unnecessary capabilities
# ✅ Scan images for vulnerabilities before deployment
#
# RESOURCE MANAGEMENT
# ✅ Set appropriate memory and CPU limits
# ✅ Configure health checks for all services
# ✅ Implement proper logging
# ✅ Set up monitoring and alerting
#
# NETWORK SECURITY
# ✅ Use internal Docker networks
# ✅ Don't expose database ports externally
# ✅ Implement proper firewall rules
# ✅ Use reverse proxy for SSL termination
#
# DATA MANAGEMENT
# ✅ Use named volumes for persistent data
# ✅ Implement backup strategies
# ✅ Never store sensitive data in images
# ✅ Use external secrets management
#
# ===============================================================================================
